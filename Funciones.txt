/*FUNCIONES EJERCICIOS*/

/*1. Crea una función en la que dado un número de habitación y una fecha nos devuelva el precio de esa 
habitación en esa fecha en régimen de sólo alojamiento.*/

create or replace function preciohabitacion(auxNum habitacion.numero%type, auxFecha calendreservas.fecha%type) return number 
is
auxPrecio number := 0;

    cursor c1 is 
        select c.habitacion hab, c.fecha fecha, p.psa precio from pvptemporada p, calendreservas c, habitacion h
        where c.habitacion = h.numero and h.categoria = p.categoria;
begin
    dbms_output.enable();
    for regc1 in c1 loop
        if regc1.hab = auxNum and regc1.fecha = auxFecha then
            auxPrecio := regc1.precio;
        end if;
    end loop;
    
    return auxPrecio;
end;


SELECT preciohabitacion(8, '01/11/12') FROM dual; 



/*2. Crea una función en la que dada una categoría de habitación, una fecha y un régimen alimenticio(SA, AD, MP, PC)
nos devuelva el precio que corresponda.*/

set serveroutput on;

create or replace function precioHabitacion2(auxCat habitacion.categoria%type, auxFecha calendreservas.fecha%type, auxAliment calendreservas.alimentacion%type) 
return number 
is
auxPrecio number := 0;

    cursor c1 is 
        select psa, pad, pmp, ppc from pvptemporada p, habitacion h, calendreservas c
        where p.categoria = h.categoria and h.categoria = auxCat and h.numero = c.habitacion and c.fecha = auxFecha;
begin
    for regc1 in c1 loop
        if auxAliment = 'SA' then 
            auxPrecio := regc1.psa;
        elsif auxAliment = 'AD' then
            auxPrecio := regc1.pad;
        elsif auxAliment = 'MP' then
            auxPrecio := regc1.pmp;
        elsif auxAliment = 'PC' then
            auxPrecio := regc1.ppc;
        end if;
    end loop;
    return auxPrecio;
end;
        
select preciohabitacion2('S', '01/11/12', 'SA') from dual;


/*3. Crea una función que dado un NIF de empleado de servicios y una fecha nos indique cuantas citas tiene previstas 
para ese día.*/

create or replace function citasEmpleado(auxNif empleado.nif%type, auxFecha cita.fecha%type) return number 
is 
auxCont number := 0;
    cursor c1 is 
        select empleado, fecha from cita;
begin
    for regc1 in c1 loop
        if regc1.empleado = auxNif and regc1.fecha = auxFecha then
            auxCont := auxCont + 1;
        end if;
    end loop;
    
    return auxCont;
end;

select citasempleado('77777777S', '15/11/12') from dual;


        



